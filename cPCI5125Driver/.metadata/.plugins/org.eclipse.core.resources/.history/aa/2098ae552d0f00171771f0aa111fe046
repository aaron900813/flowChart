FILES = \
        HiCpciA429.cpp \
        HiDrv.cpp \
		
OBJS = $(patsubst %.cpp, %.o, $(FILES))

DIR = $(foreach n,$(dir $(FILES)),.obj/$(n))

INCLUDES +=$(foreach n,$(dir $(FILES)),-I $(n))
HEADFILE = HiCpciA429Public.h

EXENAME = libHRcPCI3501.so
BIN = ./$(EXENAME)

CPPFLAGS= -g -Wall -O2
CPPFLAGS  +=  "-msse" -march=core2  -fomit-frame-pointer 
CPPFLAGS  +=  -Wall -Wundef -Wpointer-arith -fPIC

LIBS = -lpthread -lrt

LIBPATH = \
          -L ./

LIBSPATH = ../Lib/
.PHONY:all
all : DIRS $(BIN)
$(BIN) :  $(OBJS)
	@echo "Linking" $(BIN)
	$(CXX)  -shared -o $@ $^ $(LIBPATH) $(LIBS)
	cp  $(BIN) $(LIBSPATH) -rf
	cp  ./$(HEADFILE) ../Include -rf
.cpp.o :
	@echo "Compiling $<"
	$(CXX) $(CPPFLAGS) $(INCLUDES) -c $< -o $@ 

.PHONY:cpci429
cPCI3501: $(FILES)
	$(CXX) $(CPPFLAGS) $(INCLUDES)  -o $@  $(FILES)
	@echo "Compiled finished"

DIRS :
	@mkdir -p $(DIR)
	@mkdir -p ../Include
	@mkdir -p $(LIBSPATH)

.PHONY:clean
clean:
	@echo "rm "$(OBJS)
	rm -f *.o *.so